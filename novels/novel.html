<script>
    // 获取URL参数
    const urlParams = new URLSearchParams(window.location.search);
    const categoryType = urlParams.get('category');
    const workId = urlParams.get('work');

    // 加载作品数据（修正路径）
    fetch(`categories.json`) // ← 路径修正
        .then(res => res.json())
        .then(categoriesData => {
            const category = categoriesData.categories.find(c => c.type === categoryType);
            const work = category.works.find(w => w.id === workId);

            // 填充作品信息
            document.getElementById('workTitle').textContent = work.title;
            document.getElementById('workCover').src = work.cover; // ← 直接使用配置中的完整路径
            if(work.author) document.getElementById('workAuthor').textContent = `作者：${work.author}`;
            if(work.description) document.getElementById('workDescription').innerHTML = work.description; // ← 改用 innerHTML 以支持 <br>

            // 加载章节数据（路径修正）
            return fetch(work.chapters_config); // ← 直接使用配置中的完整路径
        })
        .then(res => res.json())
        .then(chaptersData => {
            const container = document.getElementById('chaptersContainer');
            chaptersData.chapters.forEach(chapter => {
                const chapterHTML = `
                    <a href="/novels/novel.html?category=${categoryType}&work=${workId}&chapter=${chapter.file}" 
                       class="list-group-item list-group-item-action">
                        <div class="d-flex justify-content-between">
                            <h5 class="mb-1">${chapter.title}</h5>
                            <small>${new Date(chapter.date).toLocaleDateString()}</small> <!-- 建议添加日期字段 -->
                        </div>
                        <p class="mb-1 text-muted">${chapter.preview}</p>
                    </a>
                `;
                container.insertAdjacentHTML('beforeend', chapterHTML);
            });
        });
</script>
